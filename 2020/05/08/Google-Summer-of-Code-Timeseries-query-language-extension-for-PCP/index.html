<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"right","display":"always","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="PR links(Introcued below, both have been merged)  https://github.com/performancecopilot/pcp/pull/1005  https://github.com/performancecopilot/pcp/pull/1018   This blog is just a simple note for the pro">
<meta property="og:type" content="article">
<meta property="og:title" content="Google Summer of Code: Timeseries query language extension for PCP">
<meta property="og:url" content="http://yoursite.com/2020/05/08/Google-Summer-of-Code-Timeseries-query-language-extension-for-PCP/index.html">
<meta property="og:site_name" content="Future Gadget Laboratory">
<meta property="og:description" content="PR links(Introcued below, both have been merged)  https://github.com/performancecopilot/pcp/pull/1005  https://github.com/performancecopilot/pcp/pull/1018   This blog is just a simple note for the pro">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2020-09-05T03:45:37.647Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Google Summer of Code: Timeseries query language extension for PCP">
<meta name="twitter:description" content="PR links(Introcued below, both have been merged)  https://github.com/performancecopilot/pcp/pull/1005  https://github.com/performancecopilot/pcp/pull/1018   This blog is just a simple note for the pro">
  <link rel="canonical" href="http://yoursite.com/2020/05/08/Google-Summer-of-Code-Timeseries-query-language-extension-for-PCP/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Google Summer of Code: Timeseries query language extension for PCP | Future Gadget Laboratory</title>
  <meta name="generator" content="Hexo 3.9.0">
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146590972-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-146590972-1');
    }
  </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?404fbe87355347a9072b10059e289efd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Future Gadget Laboratory</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Member from Supernatural Psychology Association</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-star-of-david"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-elephant"></i> <br>About</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
      </li>
    
  </ul>

    

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/08/Google-Summer-of-Code-Timeseries-query-language-extension-for-PCP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kyoma">
      <meta itemprop="description" content="El Psy Congroo">
      <meta itemprop="image" content="https://madkyoma.github.io/uploads/marisa.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future Gadget Laboratory">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Google Summer of Code: Timeseries query language extension for PCP

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2020-05-08 10:53:41" itemprop="dateCreated datePublished" datetime="2020-05-08T10:53:41+08:00">2020-05-08</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-05 11:45:37" itemprop="dateModified" datetime="2020-09-05T11:45:37+08:00">2020-09-05</time>
              </span>
            
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/05/08/Google-Summer-of-Code-Timeseries-query-language-extension-for-PCP/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/05/08/Google-Summer-of-Code-Timeseries-query-language-extension-for-PCP/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>PR links(Introcued below, both have been <strong>merged</strong>)</p>
<ul>
<li><p><a href="https://github.com/performancecopilot/pcp/pull/1005" target="_blank" rel="noopener">https://github.com/performancecopilot/pcp/pull/1005</a></p>
</li>
<li><p><a href="https://github.com/performancecopilot/pcp/pull/1018" target="_blank" rel="noopener">https://github.com/performancecopilot/pcp/pull/1018</a></p>
</li>
</ul>
<p>This blog is just a simple note for the project Timeseries query language extension during this summer.</p>
<a id="more"></a>

<p><a href="https://docs.google.com/document/d/1NbdBWKcdKQCvT7mKHEch7TiGWDjNiUJg9JYQNOsgJbA/edit?usp=sharing" target="_blank" rel="noopener">My proposal link</a></p>
<p>Brief introduce to this project. (by <a href="https://github.com/goodwinos" target="_blank" rel="noopener">@mgoodwin</a> and <a href="https://github.com/natoscott" target="_blank" rel="noopener">@nathans</a>)</p>
<blockquote>
<p>Performance Co-Pilot timeseries are series of time-stamped values gathered centrally from hosts making performance data available. This data could be gathered for many metrics, at high frequency, and from many hosts. It is potentially high volume data, and searching it efficiently (querying) at speed is a non-trivial problem.<br>The Performance Co-Pilot timeseries query language is designed to allow fast querying based on metric names and labels. A command line utility and a REST API are available from pmseries and the pmproxy daemon.<br>Internally, the PCP query language makes use of the Redis distributed data store and its native timeseries features. The pmseries command line utility provides low-level access to the language.  </p>
<p>This project will extend the existing query language with:  </p>
<ol>
<li>statistical functions (sum, mean, average, standard deviation, histogram binning, top-N, N-th percentile)  </li>
<li>rate conversion function for counter metrics  </li>
<li>scale and unit conversion functions  </li>
<li>mathematical functions (abs, floor, log, sqrt, round)  </li>
<li>binary operators for numeric metrics (addition, subtraction, division, multiplication, exponentiation)</li>
</ol>
</blockquote>
<h1 id="Grammar"><a href="#Grammar" class="headerlink" title="Grammar"></a>Grammar</h1><p>The grammar description file is located on src/libpcp_web/src/query_parser.y. It’s a yacc file. </p>
<h2 id="Existing-related-grammar"><a href="#Existing-related-grammar" class="headerlink" title="Existing related grammar"></a>Existing related grammar</h2><p>$query\to vector$</p>
<h2 id="Extended-grammar"><a href="#Extended-grammar" class="headerlink" title="Extended grammar"></a>Extended grammar</h2><p>$non-terminal\ symbol, {\bf terminal\ symbol}$</p>
<ul>
<li>$vector\to func\ {\bf EOS}$</li>
<li>$val$_$vec \to {\bf name} \{exprlist\}[timelist]$</li>
<li>$val$_$vec \to {\bf name}[timelist]$</li>
<li>$func\to {\bf rate}(val$_$vec)$</li>
<li>$func\to {\bf rate}(func)$</li>
<li>$func\to {\bf noop}(val$_$vec)$</li>
<li>$func\to {\bf noop}(func)$</li>
<li>$func\to {\bf max}(val$_$vec)$</li>
<li>$func\to {\bf max}(func)$</li>
<li>$func\to {\bf min}(val$_$vec)$</li>
<li>$func\to {\bf min}(func)$</li>
<li>$func\to {\bf rescale}(val$_$vec, {\bf string})$, where string is a units string</li>
<li>$func\to {\bf rescale}(func, {\bf string})$, where string is a units string</li>
<li>$func\to {\bf abs}(val$_$vec)$</li>
<li>$func\to {\bf abs}(func)$</li>
<li>$func\to {\bf floor}(val$_$vec)$</li>
<li>$func\to {\bf floor}(func)$</li>
<li>$func\to {\bf log}(val$_$vec)$</li>
<li>$func\to {\bf log}(func)$</li>
<li>$func\to {\bf log}(val$_$vec, {\bf number})$</li>
<li>$func\to {\bf log}(func, {\bf number})$</li>
<li>$func\to {\bf sqrt}(val$_$vec)$</li>
<li>$func\to {\bf sqrt}(func)$</li>
<li>$func\to {\bf round}(val$_$vec)$</li>
<li>$func\to {\bf round}(func)$</li>
<li>$func\to arithmetic$_$expression$</li>
<li>$arithmetic$ _ $expression\to val$ _ $vec+val$ _ $vec$</li>
<li>$arithmetic$ _ $expression\to val$ _ $vec+func$</li>
<li>$arithmetic$ _ $expression\to func+val$ _ $vec$</li>
<li>$arithmetic$ _ $expression\to val$ _ $vec-val$ _ $vec$</li>
<li>$arithmetic$ _ $expression\to val$ _ $vec-func$</li>
<li>$arithmetic$_$expression\to func-val$ _ $vec$</li>
<li>$arithmetic$ _ $expression\to val$ _ $vec*val$ _ $vec$</li>
<li>$arithmetic$ _ $expression\to val$ _ $vec*func$</li>
<li>$arithmetic$ _ $expression\to func*val$ _ $vec$ </li>
<li>$arithmetic$ _ $expression\to val$_$vec/val$ _ $vec$</li>
<li>$arithmetic$ _ $expression\to val$ _ $vec/func$</li>
<li>$arithmetic$ _ $expression\to func/val$ _ $vec$</li>
</ul>
<h1 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h1><h2 id="Storing-time-series-values-amp-pmDesc-into-paser-tree’s-nodes"><a href="#Storing-time-series-values-amp-pmDesc-into-paser-tree’s-nodes" class="headerlink" title="Storing time series values&amp;pmDesc into paser tree’s nodes"></a><del>Storing time series values&amp;pmDesc into paser tree’s nodes</del></h2><p>Store the series values returned by Redis into the corresponding node in node_t tree, for the further functions’ computation.</p>
<h3 id="Changes-in-data-structures"><a href="#Changes-in-data-structures" class="headerlink" title="Changes in data structures"></a>Changes in data structures</h3><p>In src/libpcp_web/src/query.c</p>
<ul>
<li>Modify constant QUERY_PHASES from 6 to 7.<br>The new phase series_query_funcs() is for storing timeseries values into the corresponding node. And the 7th phase series_query_funcs_report_values() is for functions’ computation and reporting.</li>
</ul>
<p>In src/libpcp_web/src/query.h</p>
<ul>
<li>Add a new structure <code>struct series_value_set</code> in order to store time series values. And add this struct into <code>struct node</code>. In <code>series_value_set</code>:  A <code>value_set</code> has a <code>series_values</code> array. Each element in <code>series_values</code> array is a timeseries with its samples and SID. A timeseries may has more than one samples stored in array <code>series_sample</code>. Each element in array <code>series_sample</code> is a set of instances’ values.</li>
</ul>
<h2 id="Writing-functions"><a href="#Writing-functions" class="headerlink" title="Writing functions"></a>Writing functions</h2><p><a href="https://github.com/performancecopilot/pcp/compare/master...ElephantZhang:demo_add_rate" target="_blank" rel="noopener">Git branch link</a><br>This branch has been <strong>merged</strong>. But need a large amount of tests!<br>Still, there are a large part in statistical functions is unfinieshed. (sum, mean, average, standard deviation, histogram binning, top-N, N-th percentile)</p>
<h3 id="Changes-in-data-structures-1"><a href="#Changes-in-data-structures-1" class="headerlink" title="Changes in data structures"></a>Changes in data structures</h3><p>In src/libpcp_web/src/query.h</p>
<ul>
<li>Add a new structure <code>typedef  struct timing</code> to <code>struct node</code> for storing timing information of arithmetic expressions.</li>
</ul>
<h2 id="Meta-data-updation-part"><a href="#Meta-data-updation-part" class="headerlink" title="Meta-data updation part"></a><del>Meta-data updation part</del></h2><p><a href="https://github.com/performancecopilot/pcp/compare/master...ElephantZhang:hmset_descriptor" target="_blank" rel="noopener">Git branch link</a><br>This branch has been <strong>merged</strong>.</p>
<h3 id="Changes-in-data-structures-2"><a href="#Changes-in-data-structures-2" class="headerlink" title="Changes in data structures"></a>Changes in data structures</h3><p>In src/libpcp_web/src/query.c</p>
<ul>
<li>Modify constant QUERY_PHASES from 7 to 8.<br>The new added phase is for querying metric names by SIDs, this situation will happend when the [metric.name] in the query statment is GLOB i.e. kernel.all.*</li>
</ul>
<h2 id="Timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline</h2><h3 id="Early-June"><a href="#Early-June" class="headerlink" title="Early June"></a>Early June</h3><hr>
<ul>
<li>In function <code>series_solve</code>, add a new phase <code>series_query_funcs</code> before phase <code>series_query_report_values</code>.  Querying to Redis and storing timeseries values are all done in function <code>series_query_funcs</code>. <code>series_query_report_values</code> only to only to report the result value from root node.</li>
<li><code>static int series_process_func</code>: Called by <code>series_query_funcs</code>. Traverse the parser tree and once a node is an values-type node which need to query to Redis to gather actual series values, do querying and store the values into this node.</li>
<li><code>static void series_node_prepare_time</code>: Called by <code>series_process_func</code> when a child of a function-type node need to query to Redis. For each series-id stored in the child node, first store the <code>SID</code> into this node’s <code>np-&gt;value_set.series_values[i].sid = sid</code>, then query to Redis with every SID together with a timewindow. </li>
<li><code>static void series_node_prepare_time_reply</code>: Called by <code>series_node_prepare_time</code>. After Redis giving back a reply to a specific SID with a timewindow, count how many sample are in this reply. Check if this reply is correct and call <code>series_values_store_to_node</code> to store these samples into the correspoding node. Then call <code>series_node_get_desc</code> to get the <code>pmSeriesDesc</code> for this SID. Finally, update <code>np-&gt;value_set.num_series</code>, this variable is to record how many series’ values have been stored for this node.</li>
<li><code>static void series_node_get_desc</code> called by <code>series_node_prepare_time_reply</code>, prepare to query <code>pmSeriesDesc</code> for a specific SID.</li>
<li><code>static void series_node_get_desc_reply</code> called by series_node_get_desc. After Redis givng back a <code>pmSeriesDes</code> infromation for a specific SID. Store it into the corresponding parser tree  node.</li>
<li><code>static void series_values_store_to_node</code>: Called by <code>series_node_prepare_time_reply</code>. Check through a specific series’ samples replied from Redis and extract the instances’ values then call <code>series_instance_store_to_node</code> to store the instances’ values into these node. This function is roughly same as <code>series_values_reply</code>.</li>
<li><code>static int series_instance_store_to_node</code>: Called by <code>series_values_store_to_node</code>. The instance’ value store in the variable <code>value</code>. Store this value into <code>np-&gt;value_set.series_values[idx_series].series_sample[idx_sample].series_instance[idx_instance]</code>.</li>
<li><code>static void freeSeriesQueryNode</code>, called by <code>freeSeriesGetQuery</code>, just to free.</li>
<li><code>static int series_calculate</code> called by <code>series_query_report_values</code>, in this function all time series values have been stored into nodes. Therefore we can directly calculate values of a node accroding to the semantics of this node.</li>
</ul>
<h3 id="Late-June"><a href="#Late-June" class="headerlink" title="Late June"></a>Late June</h3><hr>
<ul>
<li><code>series_calculate_rate</code>: Please check the rate() in the Functions part below.</li>
<li><code>series_calculate_max</code>: Please check the min/max() in the Functions part below.</li>
<li><code>series_calculate_min</code>: Please check the min/max() in the Functions part below.</li>
</ul>
<h3 id="Early-July"><a href="#Early-July" class="headerlink" title="Early July"></a>Early July</h3><hr>
<ul>
<li>Mathematical functions’ grammars.</li>
<li><code>series_calculate_rescale(node_t *np)</code>: Call this for each N_RESCALE type node. The left child node of L_RESCALE-type node should contains a set of time series values. And the right child node should be L_SCALE, which contains the target units information. rescale() should only accept metrics with semantics instant. Compare the consistencies of 3 time/space/count dimensions between the pmUnits of input and metrics to be modified.</li>
<li><code>series_pmAtomValue_conv_str()</code>: Called by <code>series_calculate_rescale</code>, extract series values acroding to the series’ type.</li>
<li><code>compare_pmUnits(pmUnits *a, pmUnits *b)</code>: Compare whether three dimentions of two units are the same.</li>
<li><code>series_extract_type(char *typeStr)</code>: Convert a type string to constant value in code e.g. “u32” to PM_TYPE_U32.</li>
<li><code>series_extract_value(int type, sds str, pmAtomValue *oval)</code>: Convert string to value accroding to the type e.g. int, unsigned int, double etc. </li>
<li><code>series_abs_pmAtomValue(int type, pmAtomValue *val)</code>: According to the type take abs() over the *val.</li>
<li><code>series_calculate_abs(node_t *np)</code>:  Take abs() over the series values stored in *np.</li>
<li><code>series_floor_pmAtomValue(int type, pmAtomValue *val)</code>: According to the type take floor() over the *val.</li>
<li><code>series_calculate_floor(node_t *np)</code>: Take floor() over the series values stored in *np.</li>
<li><code>series_log_pmAtomValue(int itype, int *otype, pmAtomValue *val, int is_natural_log, double base)</code>: According to the itype take log() over the *val, set *otype to PM_TYPE_DOUBLE. If is_natural_log=0 then the base is setted by client, otherwise base=e.</li>
<li><code>series_calculate_log(node_t *np)</code>: Take log() over the series values stored in *np.</li>
<li><code>series_sqrt_pmAtomValue(int itype, int *otype, pmAtomValue *val)</code>: According to the itype take sqrt() over the *val, set *otype to PM_TYPE_DOUBLE. </li>
<li><code>series_calculate_sqrt(node_t *np)</code>: Take sqrt() over the series values stored in *np.</li>
<li><code>series_round_pmAtomValue(int type, pmAtomValue *val)</code>: Take round() over the series values stored in *np.</li>
<li><code>series_calculate_round(node_t *np)</code>: Take round() over the series values stored in *np.</li>
</ul>
<h3 id="Late-July"><a href="#Late-July" class="headerlink" title="Late July"></a>Late July</h3><hr>
<ul>
<li>Update tests in qa/1886</li>
<li><code>series_expr_canonical(node_t *np)</code>: Recover query statement accoding to the root node *np, generate the canonical expression.</li>
<li><del><code>series_set_function_expr_callback</code></del></li>
<li><del><code>series_set_function_expr</code></del></li>
<li><code>series_function_hash(unsigned  char *hash, node_t *np)</code>: generate JASON format expression information and hash it.</li>
<li>Fix some previous bugs</li>
</ul>
<h3 id="Early-August"><a href="#Early-August" class="headerlink" title="Early August"></a>Early August</h3><hr>
<ul>
<li>Merge branch demo_add_rate into master</li>
<li>Arithmetic expressions’ grammars.</li>
<li>Write descriptor reevaluate when querying descriptor for some SIDs. Check <a href="https://github.com/performancecopilot/pcp/compare/master...ElephantZhang:fabricated_sid" target="_blank" rel="noopener">this branch</a> . But this reevaluating method has been canceled now.</li>
<li><code>compare_pmUnits_dim(pmUnits *a, pmUnits *b)</code>: check the consistency of three dimensions between *a and *b.</li>
<li><code>pmStrSem(sds sem_str)</code>: parse the semantics string sem_str into int type.</li>
<li><code>series_calculate_binary_check()</code>: Take descriptors checking for arithmetic expressions.</li>
<li><code>calculate_plus(int *type, pmAtomValue *l_val, pmAtomValue *r_val, pmAtomValue *res)</code>: Take addition over *l_val and *r_val.</li>
<li><code>calculate_minus(int *type, pmAtomValue *l_val, pmAtomValue *r_val, pmAtomValue *res)</code>: Take subtraction over *l_val and *r_val.</li>
<li><code>calculate_star(int *type, pmAtomValue *l_val, pmAtomValue *r_val, pmAtomValue *res)</code>: Take multiplication over *l_val and *r_val.</li>
<li><code>calculate_slash(int *type, pmAtomValue *l_val, pmAtomValue *r_val, pmAtomValue *res)</code>: Take division over *l_val and *r_val.</li>
<li><code>series_calculate_order_bianry()</code>: Take binary operation over two input oprands with their type, semantics and units.</li>
<li><code>series_bianry_meta_update()</code>: Update series’ descriptors after an arithmetic expression operation.</li>
<li><code>series_calculate_plus(node_t *np)</code>: Take addition over the series values stored in *np.</li>
<li><code>series_calculate_minus(node_t *np)</code>: Take subtraction over the series values stored in *np.</li>
<li><code>series_calculate_star(node_t *np)</code>: Take multiplication over the series values stored in *np.</li>
<li><code>series_calculate_slash(node_t *np)</code>: Take division over the series values stored in *np.</li>
</ul>
<h3 id="Late-August"><a href="#Late-August" class="headerlink" title="Late August"></a>Late August</h3><hr>
<ul>
<li>Write blogs.</li>
<li><code>series_node_get_metric_name()</code>: Make a Redis command to query for a metric name with a SID.</li>
<li><code>series_node_get_metric_name_reply()</code>: Check the Redis reply contains metric name.</li>
<li><code>series_store_metric_name()</code>: called by <code>series_node_get_metric_name_reply</code>, store the metric name corresponding to a specific SID into node_t.</li>
<li><del><code>series_redis_hash_expression</code></del></li>
<li><code>series_query_mapping()</code>: prepare metric names mapping</li>
<li><code>series_query_mapping_callback()</code>: same as above</li>
<li><code>check_compatibility(pmUnits *units_a, pmUnits *units_b)</code>: Check the compatibility between two units from two series with the same metric name.</li>
<li><code>series_compatibility_convert()</code>: Use the larger scale and convert the values with the smaller scale.</li>
<li><code>extract_series_node_desc()</code>: Extract the descriptor of a series in a Redis reply. Only work for functions’ expressions query. Set fields “indom” and “pmid” directly to “511.0” and “511.0.0” respectively.</li>
<li><code>series_hmset_function_desc()</code>: HMSET the descriptor of a fabricated SID. This descripotr will be HMGET by pmSeriesDescs().</li>
<li><code>series_hmset_function_desc_callback()</code>: Check if the HMSET above command works well.</li>
</ul>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><h3 id="noop"><a href="#noop" class="headerlink" title="noop():"></a>noop():</h3><p>To check if the functions have been parsed well. </p>
<h3 id="rate"><a href="#rate" class="headerlink" title="rate()"></a>rate()</h3><p>Compute rate between samples for each metric. The number of samples in result is one less than the original samples. Only the metric with semantic counter can apply rate(). </p>
<ul>
<li>After rate(), reduce the dimension of Time by one. The type remains unchanged and the semantic become PM_SEM_INSTANT.</li>
</ul>
<p>Sample:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmseries &apos;rate(kernel.all.pswitch[count:5])&apos;</span><br></pre></td></tr></table></figure>

<p>TODO: type checking errors report. <del>metadata updates.</del></p>
<h3 id="min-max"><a href="#min-max" class="headerlink" title="min/max()"></a>min/max()</h3><p>Compare and pick the maximal/minimal instance value(s) among samples for each metric.</p>
<p>TODO: Type checking and error report. <del>Metadata updates. ~</del></p>
<p>Be careful that the results of min/max can ${\bf not}$ be computed by rate(). How to achieve this? Maybe after min/max the semantic in metadate of this metric should be updated to None. But in the other hand, the number of samples is just one and if we apply rate() the number of samples will become zero, even rate(max()) is meaningless but it will not cause problems…. But it’s better to forbid rate(max())</p>
<h3 id="rescale"><a href="#rescale" class="headerlink" title="rescale()"></a>rescale()</h3><p>Rescale the units for the input metric values. Only support metric with semantic instant.</p>
<ul>
<li>After rescale, the units of each metric will be updated and the type will be updated to PM_TYPE_DOUBLE.</li>
</ul>
<p>Sample:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pmseries &apos;rescale(kernel.all.uptime[count:2], &quot;min&quot;)&apos;</span><br><span class="line">pmseries &apos;rescale(kernel.all.uptime[count:2], &quot;sec&quot;)&apos;</span><br><span class="line">pmseries &apos;rescale(rescale(kernel.all.uptime[count:2], &quot;min&quot;), &quot;hour&quot;)&apos;</span><br></pre></td></tr></table></figure>

<h3 id="mathematical-functions"><a href="#mathematical-functions" class="headerlink" title="mathematical functions"></a>mathematical functions</h3><p><del>TODO: for each node update the series_desc after taking math funcitons!</del></p>
<ul>
<li>The types and units of results remain the same.</li>
<li>The semantics of mathematical functions will become PM_TYPE_DOUBLE.</li>
</ul>
<p>Are there some series values they are negtive numbers? for testing abs()</p>
<p>Sample:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pmseries &apos;abs(kernel.all.load[count:2])&apos;</span><br><span class="line">pmseries &apos;log(log(kernel.all.pswitch[count:2],3),2)&apos;</span><br><span class="line">pmseries &apos;log(kernel.all.load[count:2], 77)&apos;</span><br><span class="line">pmseries &apos;floor(kernel.all.load[count:2])&apos;</span><br><span class="line">pmseries &apos;round(kernel.all.load[count:2])&apos;</span><br></pre></td></tr></table></figure>

<h3 id="arithmetic-expression"><a href="#arithmetic-expression" class="headerlink" title="arithmetic expression"></a>arithmetic expression</h3><p>The semantic checks and rules of arithmetic expression follow the description in pmregisterderived(3). </p>
<ul>
<li>Two operands each has only one metric series can take arithmetic expression.</li>
<li>The number of series, samples and instances of two operands should be identical.</li>
<li>If both operands have the semantics of a counter, then only addition or subraction is allowed</li>
<li>If the left operand is a counter and the right operand is not, then only multiplication or division are allowed, or if the left operand is not a counter and the right operand is a counter, then only multiplication is allowed.</li>
<li>If the semantics of both operands is not a counter then the result will have semantics PM_SEM_INSTANT unless both operands are PM_SEM_DISCRETE in which case the result is also PM_SEM_DISCRETE. Otherwise, the result will have semantics PM_SEM_COUNTER.</li>
<li>If both operands have a dimension of Count/Time/Space and the scales are not the same, use the larger scale and convert the values of the operand with the smaller scale. The result is promoted to type PM_TYPE_DOUBLE.</li>
<li>For addition and subtraction all dimensions for each of the operands and result are identical.</li>
<li>For multiplication, the dimensions of the result are the sum of the dimensions of the operands.</li>
<li>For division, the dimensions of the result are the difference of the dimensions of the operands.</li>
<li>If the operand has not been rescaled, the type of the result is determined by the types of the operands, as per the following table which is evaluated from top to bottom until a match is found.</li>
</ul>
<table>
<thead>
<tr>
<th>Operand Types</th>
<th>Operator</th>
<th>Result Type</th>
</tr>
</thead>
<tbody><tr>
<td>either is PM_TYPE_DOUBLE</td>
<td>any</td>
<td>PM_TYPE_DOUBLE</td>
</tr>
<tr>
<td>any</td>
<td>division</td>
<td>PM_TYPE_DOUBLE</td>
</tr>
<tr>
<td>either is PM_TYPE_FLOAT</td>
<td>any</td>
<td>PM_TYPE_FLOAT</td>
</tr>
<tr>
<td>either is PM_TYPE_U64</td>
<td>any</td>
<td>PM_TYPE_U64</td>
</tr>
<tr>
<td>either is PM_TYPE_64</td>
<td>any</td>
<td>PM_TYPE_64</td>
</tr>
<tr>
<td>either is PM_TYPE_U32</td>
<td>any</td>
<td>PM_TYPE_U32</td>
</tr>
<tr>
<td>otherwise (both are PM_TYPE_32)</td>
<td>any</td>
<td>PM_TYPE_32</td>
</tr>
</tbody></table>
<ul>
<li>Specifically, for subtraction, if both operands are unsigned types and the results may lead to negative number, the reusults will become ‘no value’</li>
</ul>
<p>Sample: (Lack testing)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;kernel.all.uptime[count:2] + kernel.all.uptime[count:2]&apos;</span><br></pre></td></tr></table></figure>

<h2 id="Fabricated-SID"><a href="#Fabricated-SID" class="headerlink" title="Fabricated SID"></a>Fabricated SID</h2><h3 id="Canonical-expression-generation"><a href="#Canonical-expression-generation" class="headerlink" title="Canonical expression generation"></a>Canonical expression generation</h3><p>For a query statement we will generate a ‘canonical’ expression: discard whitespace, metadata qualifiers, and time specification in the query statement. Since the expression is for reevaluating the metadata of the result of function’s expression, and the only factor that affects metadata changes is what the metric is, we can access this by the metric name.</p>
<p>Sample:</p>
<table>
<thead>
<tr>
<th>query statement</th>
<th>canonical expression</th>
</tr>
</thead>
<tbody><tr>
<td>rate(kernel.all.load{hostname!~”prefix*”&amp;&amp;instance.name==”1 minute”}[count:10])</td>
<td>rate(metric.name==”kernel.all.load”)</td>
</tr>
<tr>
<td>(multiple metrics case)   rate(disk.dev.*[count:10])</td>
<td>rate(metric.name==”disk.dev.write_bytes”)</td>
</tr>
<tr>
<td></td>
<td>rate(metric.name==”disk.dev.write_merge”)</td>
</tr>
<tr>
<td></td>
<td>rate(metric.name==”disk.dev.write”)</td>
</tr>
<tr>
<td></td>
<td>…</td>
</tr>
</tbody></table>
<h2 id="Metadata-updating"><a href="#Metadata-updating" class="headerlink" title="Metadata updating"></a>Metadata updating</h2><p>A descriptor has the following fields:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typedef  struct  pmSeriesDesc &#123;</span><br><span class="line">	sds  indom;		/* dotted-pair instance domain identifier */</span><br><span class="line">	sds  pmid;		/* dotted-triple metric identifier */</span><br><span class="line">	sds  semantics; /* pmSemStr(3) metric semantics */</span><br><span class="line">	sds  source;	/* source identifier, from whence we came */</span><br><span class="line">	sds  type;		/* pmTypeStr(3) metric type */</span><br><span class="line">	sds  units;		/* pmUnitsStr(3) metric units */</span><br><span class="line">&#125; pmSeriesDesc;</span><br></pre></td></tr></table></figure>

<p>We can see the the fields “semantics”, “type” and “units” are computed during every function take action. In the end of a query, we generate the “canonical expression” for every SID. Then generate:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;series&quot;:&quot;expr&quot;,</span><br><span class="line">	&quot;expr&quot;:&quot;[canonical expression]&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And hash it as a “fabricated” SID for this expression. Then leave “source” unchanged (in arithmetic expression case always the left most operand’s source will be the results’ source), set “pmid” and “indom” to 511.0.0 and 511.0 repectively. Finally, hmset “pcp:desc:series:[hash value]” with the descriptor into Redis. </p>
<h1 id="Some-notes"><a href="#Some-notes" class="headerlink" title="Some notes"></a>Some notes</h1><ul>
<li><code>series_solve</code> in query.c: An overview of the phases of processing a time series query statement.</li>
<li>SHA1 computation related function <code>pmwebapi_metric_hash</code></li>
</ul>
<h1 id="Issues"><a href="#Issues" class="headerlink" title="Issues"></a>Issues</h1><ol>
<li><p><del>Run    <code>gdb --args pmseries &#39;rate(kernel.all.load)[count:2]&#39;</code>, we can see error occurs during calling <code>void freeReplyObject(void *r)</code>. Seems that I free a Redies reply twice. (But where?)</del></p>
</li>
<li><p><del>Not supoort {metadata qualifiers} in my remote host. See also point 3 in Issues.</del></p>
</li>
<li><p><del>Reported by mgoodwin:</del></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pcp-kyoma[demo_add_rate]$ pmseries -a c3d11a94d2475f002c9279a50e3a884de8b96f3e</span><br><span class="line">c3d11a94d2475f002c9279a50e3a884de8b96f3e</span><br><span class="line">pmseries: [Error] no descriptor for series identifier c3d11a94d2475f002c9279a50e3a884de8b96f3e</span><br><span class="line">Segmentation fault (core dumped)</span><br></pre></td></tr></table></figure>
</li>
<li><p><del>Sometime the daemon pmlogger will be killed by unknown reason. Or each pmlogger has a life period?</del> [May 28th] Answered by Nathans:”yes, we do start pmlogger with a fixed life-span by default (~24hrs)”</p>
</li>
<li><p><del>what does <code>series_query_end_phase</code> do?</del> [June 8th] Answered by mgoodwin:“It decrements the ref count and if zero, moves onto the next phase of the query, see seriesPassBaton. ”</p>
</li>
<li><p><del>Query statements in the format as <code>pmseries -Dquery &#39;rate(kernel.all.load{hostname==&quot;VM-0-4-ubuntu&quot;}[count:2])&#39;</code> (add the <code>{metadata qualifiers}</code>)does not work on my remote host… It only returns</del> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pmseries: [Error] no descriptor for series identifier 7d94835a09744d4cea95f06c7feb45c33ada9168</span><br><span class="line">pmseries: [Error] no descriptor for series identifier 5a835a09744d4cea95f06c7feb45c33ada91685a</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><del>The code tries to query 2 SID which do not exist. But this works on mgoodwin’s host.(Why?) I guess this error may occur in the phase <code>series_query_eval</code>? Not sure….</del></p>
<p>[July 22th]Solved by mgoodwin. To fix, flush redis:</p>
<p>sudo systemctl stop pmlogger pmproxy pmcd</p>
<p>sudo redis-cli flushall</p>
<p>sudo systemctl start pmcd pmproxy pmlogger</p>
<ol start="7">
<li><del>The following warnings appear when applying float types variables to <code>double floor(double x)</code> and <code>double sqrt(double x)</code>. Keep these warning here to remind me thinking about will them cause problems or not.</del></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">query.c:2331:15: warning: implicit declaration of function ‘floor’ [-Wimplicit-function-declaration]</span><br><span class="line">      val-&gt;f = floor(val-&gt;f);</span><br><span class="line">               ^</span><br><span class="line">query.c:2331:15: warning: incompatible implicit declaration of built-in function ‘floor’</span><br><span class="line">query.c:2331:15: note: include ‘&lt;math.h&gt;’ or provide a declaration of ‘floor’</span><br><span class="line">query.c: In function ‘series_sqrt_pmAtomValue’:</span><br><span class="line">query.c:2397:15: warning: implicit declaration of function ‘sqrt’ [-Wimplicit-function-declaration]</span><br><span class="line">      val-&gt;d = sqrt(res);</span><br><span class="line">               ^</span><br><span class="line">query.c:2397:15: warning: incompatible implicit declaration of built-in function ‘sqrt’</span><br><span class="line">query.c:2397:15: note: include ‘&lt;math.h&gt;’ or provide a declaration of ‘sqrt’</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>The function log(), it can not support some whitespace insertion, like:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmseries &apos;log(log(kernel.all.pswitch[count:2],3))&apos;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>is acceptable but</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmseries &apos;log(log(kernel.all.pswitch[count:2], 3))&apos;</span><br></pre></td></tr></table></figure>

<p>will raise error. Because the parser take part <code>log(log(kernel.all.pswitch[count:2]</code> in the query statement as a series identifier. This may be fixed by rewriting grammars.</p>
<h1 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h1><ol>
<li>About the sum(), should we take sum between samples OR between instances? And mentors suggest that we can have a sum_label() function e.g. if we like to sum all values among different hosts we can apply <code>sum_label(average(kernel.all.pswitch[count:30]), &quot;hostname&quot;)</code>. Not very clear how this going…</li>
<li>About the meta-data updation after functions has been executed. We can not update the original SID of metrics (Since the metadata of this metric has been changed e.g. rate(kernel.all.pswitch_rate))but maybe we need to fabricate a SID for this new metric with new metadata e.g. rate() should cause metric with counter semantics to become ‘instant’. And the units should go from ‘count’ to count/second, i.e. the time dimension needs to be decremented.</li>
</ol>
<h1 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h1><p>I would like to express my sincere gratitude to my mentors <a href="https://github.com/goodwinos" target="_blank" rel="noopener">@mgoodwin</a> and <a href="https://github.com/natoscott" target="_blank" rel="noopener">@nathans</a>, for their helpful suggestions, patient explanations to my questions, teaching me git-based workflow and every details of PCP. And thanks to <a href="https://github.com/Erbenos" target="_blank" rel="noopener">@Miroslav Foltýn</a> for debugging for me. I am deeply grateful for their assistance in completing this project. While there were some unanticipated areas of difficulty in the project, I brain-stormed some solutions with my mentors and I am now nearing completion on those additional items as well.<br>I believe I will make further commits on this project and work with them.<br>Also thanks to the vibrant and inclusive PCP community, new developers are always welcome to join here.</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/02/27/Compiler-for-language-tiger/" rel="next" title="Compiler for language tiger">
                  <i class="fa fa-chevron-left"></i> Compiler for language tiger
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2020/05/08/自用快速手册/" rel="prev" title="自用快速手册">
                  自用快速手册 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc" data-target="post-toc-wrap">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview-wrap">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Grammar"><span class="nav-number">1.</span> <span class="nav-text">Grammar</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Existing-related-grammar"><span class="nav-number">1.1.</span> <span class="nav-text">Existing related grammar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Extended-grammar"><span class="nav-number">1.2.</span> <span class="nav-text">Extended grammar</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Status"><span class="nav-number">2.</span> <span class="nav-text">Status</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Storing-time-series-values-amp-pmDesc-into-paser-tree’s-nodes"><span class="nav-number">2.1.</span> <span class="nav-text">Storing time series values&amp;pmDesc into paser tree’s nodes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Changes-in-data-structures"><span class="nav-number">2.1.1.</span> <span class="nav-text">Changes in data structures</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Writing-functions"><span class="nav-number">2.2.</span> <span class="nav-text">Writing functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Changes-in-data-structures-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">Changes in data structures</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Meta-data-updation-part"><span class="nav-number">2.3.</span> <span class="nav-text">Meta-data updation part</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Changes-in-data-structures-2"><span class="nav-number">2.3.1.</span> <span class="nav-text">Changes in data structures</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Timeline"><span class="nav-number">2.4.</span> <span class="nav-text">Timeline</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Early-June"><span class="nav-number">2.4.1.</span> <span class="nav-text">Early June</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Late-June"><span class="nav-number">2.4.2.</span> <span class="nav-text">Late June</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Early-July"><span class="nav-number">2.4.3.</span> <span class="nav-text">Early July</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Late-July"><span class="nav-number">2.4.4.</span> <span class="nav-text">Late July</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Early-August"><span class="nav-number">2.4.5.</span> <span class="nav-text">Early August</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Late-August"><span class="nav-number">2.4.6.</span> <span class="nav-text">Late August</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Functions"><span class="nav-number">2.5.</span> <span class="nav-text">Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#noop"><span class="nav-number">2.5.1.</span> <span class="nav-text">noop():</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rate"><span class="nav-number">2.5.2.</span> <span class="nav-text">rate()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#min-max"><span class="nav-number">2.5.3.</span> <span class="nav-text">min/max()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rescale"><span class="nav-number">2.5.4.</span> <span class="nav-text">rescale()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mathematical-functions"><span class="nav-number">2.5.5.</span> <span class="nav-text">mathematical functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#arithmetic-expression"><span class="nav-number">2.5.6.</span> <span class="nav-text">arithmetic expression</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fabricated-SID"><span class="nav-number">2.6.</span> <span class="nav-text">Fabricated SID</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Canonical-expression-generation"><span class="nav-number">2.6.1.</span> <span class="nav-text">Canonical expression generation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Metadata-updating"><span class="nav-number">2.7.</span> <span class="nav-text">Metadata updating</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Some-notes"><span class="nav-number">3.</span> <span class="nav-text">Some notes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Issues"><span class="nav-number">4.</span> <span class="nav-text">Issues</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Discussion"><span class="nav-number">5.</span> <span class="nav-text">Discussion</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Thanks"><span class="nav-number">6.</span> <span class="nav-text">Thanks</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="https://madkyoma.github.io/uploads/marisa.png"
      alt="Kyoma">
  <p class="site-author-name" itemprop="name">Kyoma</p>
  <div class="site-description" itemprop="description">El Psy Congroo</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
          
        
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/ElephantZhang" title="GitHub &rarr; https://github.com/ElephantZhang" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="http://chaoxy.com" title="Association &rarr; http://chaoxy.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-http://chaoxy.com/static/images/icon.png"></i>Association</a>
      </span>
    
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.chaoxy.com" title="http://www.chaoxy.com" rel="noopener" target="_blank">Supernatural Psychology Association</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://www.lovelywen.com" title="https://www.lovelywen.com" rel="noopener" target="_blank">WenWen's blog</a>
        </li>
      
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kyoma</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.3.0</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>
<script src="/js/schemes/muse.js?v=7.3.0"></script>

<script src="/js/next-boot.js?v=7.3.0"></script>



  








  <script src="/js/local-search.js?v=7.3.0"></script>














  

  
    
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    
  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://https-elephantzhang-github-io.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function disqus_config() {
    this.page.url = "http://yoursite.com/2020/05/08/Google-Summer-of-Code-Timeseries-query-language-extension-for-PCP/";
    this.page.identifier = "2020/05/08/Google-Summer-of-Code-Timeseries-query-language-extension-for-PCP/";
    this.page.title = 'Google Summer of Code: Timeseries query language extension for PCP';};
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://https-elephantzhang-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    window.addEventListener('load', loadComments, false);
  
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
